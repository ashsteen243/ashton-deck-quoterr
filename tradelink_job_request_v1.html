<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Job Request & Material Info - v1</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 0;
      background: #f4f5f7;
      color: #222;
    }
    .page {
      max-width: 900px;
      margin: 24px auto 40px;
      padding: 0 16px;
    }
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
      gap: 12px;
    }
    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .brand-logo {
      width: 40px;
      height: 40px;
      border-radius: 12px;
      background: #111827;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #f9fafb;
      font-weight: 700;
      font-size: 18px;
    }
    .brand-text {
      line-height: 1.1;
    }
    .brand-text span {
      display: block;
    }
    .brand-main {
      font-weight: 700;
      font-size: 18px;
    }
    .brand-tagline {
      font-size: 12px;
      color: #6b7280;
    }
    h1 {
      font-size: 22px;
      margin: 0 0 4px;
    }
    .subhead {
      margin: 0 0 12px;
      color: #4b5563;
      font-size: 14px;
    }
    .card {
      background: #ffffff;
      border-radius: 14px;
      padding: 18px 16px 20px;
      box-shadow: 0 10px 30px rgba(15, 23, 42, 0.08);
      border: 1px solid #e5e7eb;
    }
    .section-title {
      font-size: 14px;
      font-weight: 600;
      margin: 18px 0 8px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #6b7280;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 10px 14px;
    }
    label {
      display: block;
      font-size: 13px;
      margin-bottom: 4px;
      color: #374151;
    }
    label span.small {
      font-size: 11px;
      color: #9ca3af;
      font-weight: 400;
    }
    input[type="text"],
    input[type="email"],
    input[type="tel"],
    input[type="number"],
    input[type="date"],
    select,
    textarea {
      width: 100%;
      padding: 8px 9px;
      border-radius: 9px;
      border: 1px solid #d1d5db;
      font-size: 13px;
      outline: none;
      background: #f9fafb;
      transition: border-color 0.15s ease, box-shadow 0.15s ease, background 0.15s ease;
      resize: vertical;
      min-height: 0;
    }
    textarea {
      min-height: 64px;
    }
    input:focus,
    select:focus,
    textarea:focus {
      border-color: #111827;
      box-shadow: 0 0 0 1px #11182711;
      background: #ffffff;
    }
    .inline-hint {
      font-size: 11px;
      color: #9ca3af;
      margin-top: 3px;
    }
    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 3px;
    }
    .pill {
      font-size: 11px;
      padding: 4px 7px;
      border-radius: 999px;
      background: #f3f4f6;
      border: 1px solid #e5e7eb;
      cursor: pointer;
      user-select: none;
    }
    .pill[data-active="true"] {
      background: #111827;
      border-color: #111827;
      color: #f9fafb;
    }
    .project-section {
      display: none;
      margin-top: 8px;
      padding-top: 10px;
      border-top: 1px dashed #e5e7eb;
    }
    .note-box {
      font-size: 11px;
      padding: 8px 10px;
      border-radius: 9px;
      background: #f9fafb;
      border: 1px dashed #d1d5db;
      color: #4b5563;
      margin-top: 6px;
    }
    .material-estimate {
      margin-top: 12px;
      padding: 10px 10px 10px;
      border-radius: 11px;
      background: #f3f4ff;
      border: 1px solid #c7d2fe;
      font-size: 12px;
    }
    .material-estimate h3 {
      font-size: 13px;
      margin: 0 0 6px;
    }
    .material-estimate ul {
      margin: 0 0 6px 18px;
      padding: 0;
    }
    .material-estimate .note {
      font-size: 11px;
      color: #4b5563;
    }
    .actions {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 16px;
      align-items: center;
    }
    button,
    .btn-link {
      border: none;
      cursor: pointer;
      font-size: 13px;
      border-radius: 999px;
      padding: 8px 14px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      text-decoration: none;
      white-space: nowrap;
    }
    .btn-primary {
      background: #111827;
      color: #f9fafb;
    }
    .btn-secondary {
      background: #e5e7eb;
      color: #111827;
    }
    .btn-link {
      padding: 0;
      background: none;
      border-radius: 0;
      color: #4b5563;
    }
    .tiny {
      font-size: 11px;
      color: #9ca3af;
      margin-top: 4px;
    }
    #summaryBox {
      display: none;
      margin-top: 16px;
      border-radius: 14px;
      background: #0f172a;
      color: #e5e7eb;
      padding: 14px 14px 12px;
    }
    #summaryBox h2 {
      font-size: 14px;
      margin: 0 0 6px;
    }
    #summaryText {
      width: 100%;
      border-radius: 9px;
      border: 1px solid #1f2937;
      background: #020617;
      color: #e5e7eb;
      font-size: 12px;
      padding: 8px 9px;
      min-height: 120px;
      resize: vertical;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }
    .summary-actions {
      margin-top: 6px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
    }
    .summary-actions a {
      color: #bfdbfe;
      font-size: 12px;
    }
    .badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 3px 7px;
      border-radius: 999px;
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      background: #e5e7eb;
      color: #4b5563;
    }
    .warning {
      font-size: 11px;
      color: #9ca3af;
      margin-top: 6px;
    }
    @media (max-width: 600px) {
      .card {
        padding: 14px 12px 16px;
      }
      header { flex-direction: column; align-items: flex-start; }
    }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <div class="brand">
        <div class="brand-logo">TL</div>
        <div class="brand-text">
          <span class="brand-main">TradeLink</span>
          <span class="brand-tagline">Built by Kiwis for Kiwis</span>
        </div>
      </div>
      <div class="badge">Internal job request</div>
    </header>

    <div class="card">
      <h1>New Job Request</h1>
      <p class="subhead">
        Client fills this in once. You get a clean email with all details + a rough material guide for decks.
      </p>

      <form id="jobForm" autocomplete="on">
        <!-- WHO + WHERE -->
        <div class="section-title">Client &amp; Site</div>
        <div class="grid">
          <div>
            <label for="clientName">Client name</label>
            <input id="clientName" name="clientName" type="text" required placeholder="Full name" />
          </div>
          <div>
            <label for="clientPhone">Phone</label>
            <input id="clientPhone" name="clientPhone" type="tel" placeholder="Mobile" />
          </div>
          <div>
            <label for="clientEmail">Email</label>
            <input id="clientEmail" name="clientEmail" type="email" placeholder="Optional" />
          </div>
          <div>
            <label for="siteAddress">Site address</label>
            <input id="siteAddress" name="siteAddress" type="text" placeholder="Where the work is" />
          </div>
        </div>

        <div class="grid" style="margin-top: 8px;">
          <div>
            <label for="bestTime">Best time to contact</label>
            <select id="bestTime" name="bestTime">
              <option value="">Anytime</option>
              <option value="Morning">Morning</option>
              <option value="Afternoon">Afternoon</option>
              <option value="Evening">Evening</option>
              <option value="Email only">Email only</option>
            </select>
          </div>
          <div>
            <label for="startDate">Rough start timing <span class="small">(if known)</span></label>
            <input id="startDate" name="startDate" type="date" />
          </div>
        </div>

        <!-- PROJECT TYPE -->
        <div class="section-title">What do you need done?</div>
        <div class="grid">
          <div>
            <label for="projectType">Project type</label>
            <select id="projectType" name="projectType" required>
              <option value="">Select one</option>
              <option value="deck">Deck</option>
              <option value="fence">Fence</option>
              <option value="gate">Gate</option>
              <option value="retaining">Retaining wall</option>
              <option value="room">New room / sleepout</option>
              <option value="extension">House extension / renovation</option>
              <option value="other">Other</option>
            </select>
          </div>
          <div>
            <label for="projectNotes">Quick description</label>
            <textarea id="projectNotes" name="projectNotes" placeholder="Eg. New deck off lounge, approx 4m x 3m, 1m off ground."></textarea>
          </div>
        </div>

        <!-- PHOTOS -->
        <div class="section-title">Photos</div>
        <div class="grid">
          <div>
            <label for="photos">Upload photos / sketches</label>
            <input id="photos" name="photos" type="file" multiple />
            <div class="inline-hint">
              Take photos of the area from a few angles. These stay on your device – they are NOT actually sent anywhere with this offline version.
            </div>
          </div>
          <div>
            <label>Photo list that gets emailed</label>
            <div id="photoList" class="note-box">
              No files selected yet.
            </div>
          </div>
        </div>

        <!-- DECK QUESTIONS -->
        <div class="project-section" data-project="deck">
          <div class="section-title">Deck details</div>
          <div class="grid">
            <div>
              <label>Overall size (approx)</label>
              <div style="display:flex; gap:6px;">
                <input id="deckLength" name="deckLength" type="number" step="0.1" min="0" placeholder="Length (m)" />
                <input id="deckWidth" name="deckWidth" type="number" step="0.1" min="0" placeholder="Width (m)" />
              </div>
              <div class="inline-hint">Exact is great but rough is fine too.</div>
            </div>
            <div>
              <label for="deckHeight">Height off ground (approx)</label>
              <select id="deckHeight" name="deckHeight">
                <option value="">Select</option>
                <option value="Ground level (0–400mm)">Ground level (0–400mm)</option>
                <option value="Mid height (400–1m)">Mid height (400–1m)</option>
                <option value="High (1m+)">High (1m+)</option>
              </select>
            </div>
            <div>
              <label for="deckType">Attached or free-standing?</label>
              <select id="deckType" name="deckType">
                <option value="">Select</option>
                <option value="Attached to house">Attached to house</option>
                <option value="Free-standing">Free-standing</option>
                <option value="Unsure">Unsure</option>
              </select>
            </div>
            <div>
              <label for="deckAccess">Access</label>
              <select id="deckAccess" name="deckAccess">
                <option value="">Select</option>
                <option value="Easy access (flat, clear)">Easy access (flat, clear)</option>
                <option value="Tricky access (narrow / steep)">Tricky access (narrow / steep)</option>
                <option value="Unsure">Unsure</option>
              </select>
            </div>
          </div>

          <div class="grid" style="margin-top:8px;">
            <div>
              <label for="boardType">Decking board material</label>
              <select id="boardType" name="boardType">
                <option value="">No preference</option>
                <option value="Pine">Pine</option>
                <option value="Kwila / hardwood">Kwila / hardwood</option>
                <option value="Composite">Composite</option>
              </select>
            </div>
            <div>
              <label for="boardWidth">Board width (mm)</label>
              <input id="boardWidth" name="boardWidth" type="number" step="1" min="60" max="190" value="140" />
              <div class="inline-hint">Common NZ sizes: 90, 140.</div>
            </div>
          </div>

          <div class="grid" style="margin-top:8px;">
            <div>
              <label>Stairs?</label>
              <div class="pill-row" data-field="stairs">
                <div class="pill" data-value="No stairs">No stairs</div>
                <div class="pill" data-value="One set of stairs">1 set</div>
                <div class="pill" data-value="Multiple stairs / landings">Multiple / landing</div>
              </div>
              <input id="deckStairs" name="deckStairs" type="hidden" />
            </div>
            <div>
              <label>Handrail / balustrade?</label>
              <div class="pill-row" data-field="handrail">
                <div class="pill" data-value="No handrail">No handrail</div>
                <div class="pill" data-value="Timber handrail">Timber</div>
                <div class="pill" data-value="Glass / aluminium balustrade">Glass / aluminium</div>
              </div>
              <input id="deckHandrail" name="deckHandrail" type="hidden" />
            </div>
          </div>

          <div style="margin-top:8px;">
            <label for="deckExtras">Anything else you'd like on the deck?</label>
            <textarea id="deckExtras" name="deckExtras" placeholder="Eg. Built-in seats, privacy screens, steps down to lawn, etc."></textarea>
          </div>

          <div id="materialEstimate" class="material-estimate" style="display:none;"></div>
        </div>

        <!-- FENCE QUESTIONS -->
        <div class="project-section" data-project="fence">
          <div class="section-title">Fence details</div>
          <div class="grid">
            <div>
              <label for="fenceLength">Approx fence length (m)</label>
              <input id="fenceLength" name="fenceLength" type="number" step="0.1" min="0" />
            </div>
            <div>
              <label for="fenceHeight">Fence height</label>
              <select id="fenceHeight" name="fenceHeight">
                <option value="">Select</option>
                <option value="Low (up to 1.2m)">Low (up to 1.2m)</option>
                <option value="Standard (1.5–1.8m)">Standard (1.5–1.8m)</option>
                <option value="High (1.8m+)">High (1.8m+)</option>
              </select>
            </div>
            <div>
              <label for="fenceStyle">Fence style</label>
              <select id="fenceStyle" name="fenceStyle">
                <option value="">Not sure</option>
                <option value="Timber paling">Timber paling</option>
                <option value="Horizontal slat">Horizontal slat</option>
                <option value="Picket">Picket</option>
                <option value="Other / mix">Other / mix</option>
              </select>
            </div>
            <div>
              <label for="fenceTerrain">Ground type</label>
              <select id="fenceTerrain" name="fenceTerrain">
                <option value="">Select</option>
                <option value="Flat lawn">Flat lawn</option>
                <option value="Sloping ground">Sloping ground</option>
                <option value="Retaining / boundary wall involved">Retaining / wall involved</option>
              </select>
            </div>
          </div>
          <div style="margin-top:8px;">
            <label for="fenceExtras">Fence notes</label>
            <textarea id="fenceExtras" name="fenceExtras" placeholder="Eg. Replace old fence, keep existing posts, dog‑proof, etc."></textarea>
          </div>
        </div>

        <!-- GATE QUESTIONS -->
        <div class="project-section" data-project="gate">
          <div class="section-title">Gate details</div>
          <div class="grid">
            <div>
              <label for="gateOpening">Opening width (approx m)</label>
              <input id="gateOpening" name="gateOpening" type="number" step="0.1" min="0" />
            </div>
            <div>
              <label for="gateHeight">Gate height</label>
              <input id="gateHeight" name="gateHeight" type="number" step="0.1" min="0" placeholder="Height (m)" />
            </div>
            <div>
              <label for="gateType">Gate type</label>
              <select id="gateType" name="gateType">
                <option value="">Select</option>
                <option value="Pedestrian">Pedestrian</option>
                <option value="Driveway – single">Driveway – single</option>
                <option value="Driveway – double">Driveway – double</option>
                <option value="Sliding">Sliding</option>
              </select>
            </div>
            <div>
              <label for="gateMaterial">Material</label>
              <select id="gateMaterial" name="gateMaterial">
                <option value="">Not sure</option>
                <option value="Timber">Timber</option>
                <option value="Aluminium">Aluminium</option>
                <option value="Other / mix">Other / mix</option>
              </select>
            </div>
          </div>
          <div style="margin-top:8px;">
            <label for="gateExtras">Gate notes</label>
            <textarea id="gateExtras" name="gateExtras" placeholder="Eg. Lockable, automatic, match existing fence, etc."></textarea>
          </div>
        </div>

        <!-- RETAINING -->
        <div class="project-section" data-project="retaining">
          <div class="section-title">Retaining wall details</div>
          <div class="grid">
            <div>
              <label for="retainingLength">Wall length (m)</label>
              <input id="retainingLength" name="retainingLength" type="number" step="0.1" min="0" />
            </div>
            <div>
              <label for="retainingHeight">Max height (m)</label>
              <input id="retainingHeight" name="retainingHeight" type="number" step="0.1" min="0" />
            </div>
            <div>
              <label for="retainingType">Type</label>
              <select id="retainingType" name="retainingType">
                <option value="">Not sure</option>
                <option value="Timber pole">Timber pole</option>
                <option value="Concrete blocks">Concrete blocks</option>
                <option value="Keystone / segmental system">Keystone / segmental</option>
              </select>
            </div>
          </div>
          <div style="margin-top:8px;">
            <label for="retainingExtras">Retaining notes</label>
            <textarea id="retainingExtras" name="retainingExtras" placeholder="Eg. Replace existing failing wall, new build, engineer involved, etc."></textarea>
          </div>
        </div>

        <!-- ROOM / EXTENSION / OTHER -->
        <div class="project-section" data-project="room">
          <div class="section-title">New room / sleepout</div>
          <div class="grid">
            <div>
              <label for="roomSize">Approx size (m²)</label>
              <input id="roomSize" name="roomSize" type="number" step="0.1" min="0" />
            </div>
            <div>
              <label for="roomUse">Main use</label>
              <select id="roomUse" name="roomUse">
                <option value="">Select</option>
                <option value="Bedroom">Bedroom</option>
                <option value="Office">Office</option>
                <option value="Hobby / studio">Hobby / studio</option>
                <option value="Other">Other</option>
              </select>
            </div>
          </div>
          <div style="margin-top:8px;">
            <label for="roomNotes">Room notes</label>
            <textarea id="roomNotes" name="roomNotes" placeholder="Eg. Plumbing needed, bathroom, small deck off room, etc."></textarea>
          </div>
        </div>

        <div class="project-section" data-project="extension">
          <div class="section-title">House extension / reno</div>
          <div style="margin-top:4px;">
            <label for="extensionNotes">Tell us roughly what you're thinking</label>
            <textarea id="extensionNotes" name="extensionNotes" placeholder="Eg. Push lounge out 3m, new bedroom over garage, re‑clad, etc."></textarea>
          </div>
        </div>

        <div class="project-section" data-project="other">
          <div class="section-title">Other work</div>
          <div style="margin-top:4px;">
            <label for="otherNotes">Describe the job</label>
            <textarea id="otherNotes" name="otherNotes" placeholder="Anything building related – explain in your own words."></textarea>
          </div>
        </div>

        <!-- INTERNAL EMAIL SETTINGS -->
        <div class="section-title">Where should this go?</div>
        <div class="grid">
          <div>
            <label for="emailTo">Send summary to this email</label>
            <input id="emailTo" name="emailTo" type="email" placeholder="your-dad-email@example.com" />
            <div class="inline-hint">Change this to your dad's work email. The 'Open in email' button uses it.</div>
          </div>
          <div>
            <label for="refCode">Internal reference <span class="small">(optional)</span></label>
            <input id="refCode" name="refCode" type="text" placeholder="Eg. TL‑001, Facebook lead, etc." />
          </div>
        </div>

        <div class="note-box" style="margin-top:10px;">
          <strong>How this v1 works:</strong> when you hit <em>Build email summary</em>, it creates a clean text summary you can:
          <ul style="margin:6px 0 0 18px; padding:0; font-size:11px;">
            <li>Copy &amp; paste into an email or job system, or</li>
            <li>Use the <em>Open in email</em> button which opens your default mail app pre‑filled.</li>
          </ul>
          Attach the actual photos manually to your email (file names are included in the summary).
        </div>

        <div class="actions">
          <button type="submit" class="btn-primary">Build email summary</button>
          <button type="reset" class="btn-secondary" id="resetBtn">Clear form</button>
          <span class="tiny">Nothing is sent anywhere until you send the email.</span>
        </div>
      </form>

      <!-- SUMMARY OUTPUT -->
      <div id="summaryBox">
        <h2>Email summary for your dad</h2>
        <textarea id="summaryText" readonly></textarea>
        <div class="summary-actions">
          <button type="button" class="btn-secondary" id="copyBtn">Copy summary</button>
          <a id="mailtoLink" href="#" target="_blank" rel="noopener noreferrer">Open in email app</a>
          <span id="copyStatus" class="tiny"></span>
        </div>
        <div class="warning">
          Attach the client photos to the email before sending. This tool only lists file names; it doesn't upload anything.
        </div>
      </div>
    </div>
  </div>

  <script>
    (function () {
      const projectTypeSelect = document.getElementById("projectType");
      const projectSections = document.querySelectorAll(".project-section");
      const materialBox = document.getElementById("materialEstimate");
      const photoInput = document.getElementById("photos");
      const photoList = document.getElementById("photoList");
      const form = document.getElementById("jobForm");
      const summaryBox = document.getElementById("summaryBox");
      const summaryText = document.getElementById("summaryText");
      const mailtoLink = document.getElementById("mailtoLink");
      const emailToInput = document.getElementById("emailTo");
      const copyBtn = document.getElementById("copyBtn");
      const copyStatus = document.getElementById("copyStatus");
      const resetBtn = document.getElementById("resetBtn");

      function showProjectSection() {
        const value = projectTypeSelect.value;
        projectSections.forEach((section) => {
          if (section.getAttribute("data-project") === value) {
            section.style.display = "block";
          } else {
            section.style.display = "none";
          }
        });
        if (value !== "deck") {
          materialBox.style.display = "none";
          materialBox.innerHTML = "";
        } else {
          updateDeckEstimate();
        }
      }

      function updateDeckEstimate() {
        const length = parseFloat(document.getElementById("deckLength").value) || 0;
        const width = parseFloat(document.getElementById("deckWidth").value) || 0;
        const boardWidth = parseFloat(document.getElementById("boardWidth").value) || 0;

        if (!length || !width || !boardWidth) {
          materialBox.style.display = "none";
          materialBox.innerHTML = "";
          return;
        }

        const area = length * width; // m²
        const gapMm = 5;
        const effectiveBoardWidthM = (boardWidth + gapMm) / 1000;
        const linealBoardsLm = area / effectiveBoardWidthM;

        const joistSpacingM = 0.45;
        const joistCount = Math.floor(length / joistSpacingM) + 1;
        const joistLengthTotal = joistCount * width;

        const postSpacingM = 1.8;
        const postsAlongLength = Math.max(2, Math.ceil(length / postSpacingM) + 1);
        const postsAlongWidth = Math.max(2, Math.ceil(width / postSpacingM) + 1);
        const approxPosts = postsAlongLength * postsAlongWidth;

        materialBox.style.display = "block";
        materialBox.innerHTML =
          '<h3>Rough material estimate (internal only)</h3>' +
          "<ul>" +
          "<li>Approx deck area: <strong>" + area.toFixed(1) + " m²</strong></li>" +
          "<li>Decking boards (lineal metres): <strong>~" + linealBoardsLm.toFixed(0) + " lm</strong></li>" +
          "<li>Joists @ 450 centres: <strong>" + joistCount + "</strong> joists × " + width.toFixed(2) + " m (total ~" + joistLengthTotal.toFixed(0) + " lm)</li>" +
          "<li>Posts (very rough): <strong>~" + approxPosts + "</strong> posts</li>" +
          "</ul>" +
          '<p class="note">This is a quick guide only. Always check spans, fixings and NZ standards / manufacturer specs before ordering.</p>';
      }

      function updatePhotoList() {
        if (!photoInput.files || photoInput.files.length === 0) {
          photoList.textContent = "No files selected yet.";
          return;
        }
        const names = Array.from(photoInput.files).map((f) => "• " + f.name);
        photoList.innerHTML = names.join("<br>");
      }

      function setupPills() {
        document.querySelectorAll(".pill-row").forEach((row) => {
          const field = row.getAttribute("data-field");
          const hiddenInputId =
            field === "stairs" ? "deckStairs" :
            field === "handrail" ? "deckHandrail" :
            null;
          const hiddenInput = hiddenInputId ? document.getElementById(hiddenInputId) : null;

          row.querySelectorAll(".pill").forEach((pill) => {
            pill.addEventListener("click", () => {
              row.querySelectorAll(".pill").forEach((p) => p.setAttribute("data-active", "false"));
              pill.setAttribute("data-active", "true");
              if (hiddenInput) {
                hiddenInput.value = pill.getAttribute("data-value") || "";
              }
            });
          });
        });
      }

      function buildSummary(formData) {
        const type = formData.get("projectType") || "";
        const typeLabel = {
          deck: "Deck",
          fence: "Fence",
          gate: "Gate",
          retaining: "Retaining wall",
          room: "New room / sleepout",
          extension: "House extension / renovation",
          other: "Other"
        }[type] || type || "Not selected";

        let lines = [];
        const refCode = formData.get("refCode") || "";

        lines.push("New client job request");
        if (refCode) {
          lines.push("Ref: " + refCode);
        }
        lines.push("");
        lines.push("Client & site");
        lines.push("Name: " + (formData.get("clientName") || ""));
        lines.push("Phone: " + (formData.get("clientPhone") || ""));
        lines.push("Email: " + (formData.get("clientEmail") || ""));
        lines.push("Site address: " + (formData.get("siteAddress") || ""));
        lines.push("Best time to contact: " + (formData.get("bestTime") || "Anytime"));
        lines.push("Rough start timing: " + (formData.get("startDate") || "Not given"));
        lines.push("");
        lines.push("Project overview");
        lines.push("Type: " + typeLabel);
        lines.push("Quick description: " + (formData.get("projectNotes") || ""));
        lines.push("");

        if (type === "deck") {
          lines.push("Deck details");
          const length = formData.get("deckLength") || "";
          const width = formData.get("deckWidth") || "";
          if (length || width) {
            lines.push("Approx size: " + (length || "?") + " m × " + (width || "?") + " m");
          }
          lines.push("Height off ground: " + (formData.get("deckHeight") || ""));
          lines.push("Attached / freestanding: " + (formData.get("deckType") || ""));
          lines.push("Access: " + (formData.get("deckAccess") || ""));
          lines.push("Decking board material: " + (formData.get("boardType") || ""));
          lines.push("Decking board width: " + (formData.get("boardWidth") || "") + " mm");
          lines.push("Stairs: " + (formData.get("deckStairs") || ""));
          lines.push("Handrail / balustrade: " + (formData.get("deckHandrail") || ""));
          lines.push("Extras: " + (formData.get("deckExtras") || ""));
          lines.push("");

          if (materialBox && materialBox.innerText.trim()) {
            lines.push("Rough deck material estimate (from form – check before ordering):");
            lines.push(materialBox.innerText.trim());
            lines.push("");
          }
        } else if (type === "fence") {
          lines.push("Fence details");
          lines.push("Approx length: " + (formData.get("fenceLength") || "") + " m");
          lines.push("Fence height: " + (formData.get("fenceHeight") || ""));
          lines.push("Style: " + (formData.get("fenceStyle") || ""));
          lines.push("Ground type: " + (formData.get("fenceTerrain") || ""));
          lines.push("Notes: " + (formData.get("fenceExtras") || ""));
          lines.push("");
        } else if (type === "gate") {
          lines.push("Gate details");
          lines.push("Opening width: " + (formData.get("gateOpening") || "") + " m");
          lines.push("Gate height: " + (formData.get("gateHeight") || "") + " m");
          lines.push("Gate type: " + (formData.get("gateType") || ""));
          lines.push("Material: " + (formData.get("gateMaterial") || ""));
          lines.push("Notes: " + (formData.get("gateExtras") || ""));
          lines.push("");
        } else if (type === "retaining") {
          lines.push("Retaining wall details");
          lines.push("Wall length: " + (formData.get("retainingLength") || "") + " m");
          lines.push("Max height: " + (formData.get("retainingHeight") || "") + " m");
          lines.push("Type: " + (formData.get("retainingType") || ""));
          lines.push("Notes: " + (formData.get("retainingExtras") || ""));
          lines.push("");
        } else if (type === "room") {
          lines.push("New room / sleepout");
          lines.push("Approx size: " + (formData.get("roomSize") || "") + " m²");
          lines.push("Main use: " + (formData.get("roomUse") || ""));
          lines.push("Notes: " + (formData.get("roomNotes") || ""));
          lines.push("");
        } else if (type === "extension") {
          lines.push("House extension / reno");
          lines.push("Notes: " + (formData.get("extensionNotes") || ""));
          lines.push("");
        } else if (type === "other") {
          lines.push("Other work");
          lines.push("Notes: " + (formData.get("otherNotes") || ""));
          lines.push("");
        }

        lines.push("Photos (file names only – you still need to attach the actual files to the email):");
        if (photoInput.files && photoInput.files.length > 0) {
          Array.from(photoInput.files).forEach((f, idx) => {
            lines.push("  " + (idx + 1) + ". " + f.name);
          });
        } else {
          lines.push("  None uploaded in the form.");
        }
        lines.push("");

        lines.push("Generated by TradeLink job form v1.");
        return lines.join("\n");
      }

      projectTypeSelect.addEventListener("change", showProjectSection);
      ["deckLength", "deckWidth", "boardWidth"].forEach((id) => {
        const el = document.getElementById(id);
        if (el) {
          el.addEventListener("input", updateDeckEstimate);
        }
      });
      if (photoInput) {
        photoInput.addEventListener("change", updatePhotoList);
      }
      setupPills();

      form.addEventListener("submit", function (e) {
        e.preventDefault();
        copyStatus.textContent = "";
        const data = new FormData(form);
        const summary = buildSummary(data);
        summaryText.value = summary;
        summaryBox.style.display = "block";

        const emailTo = emailToInput.value || "";
        const type = data.get("projectType") || "";
        const typeLabel = {
          deck: "Deck",
          fence: "Fence",
          gate: "Gate",
          retaining: "Retaining wall",
          room: "New room / sleepout",
          extension: "House extension / renovation",
          other: "Other"
        }[type] || "Job";

        const subject = encodeURIComponent("New " + typeLabel + " request - " + (data.get("clientName") || ""));
        const body = encodeURIComponent(summary);
        const mailto = "mailto:" + encodeURIComponent(emailTo) + "?subject=" + subject + "&body=" + body;
        mailtoLink.href = mailto;
      });

      copyBtn.addEventListener("click", async function () {
        if (!summaryText.value) return;
        try {
          await navigator.clipboard.writeText(summaryText.value);
          copyStatus.textContent = "Copied to clipboard.";
        } catch (err) {
          copyStatus.textContent = "Copy failed – you can still select & copy manually.";
        }
      });

      resetBtn.addEventListener("click", function () {
        setTimeout(() => {
          summaryBox.style.display = "none";
          materialBox.style.display = "none";
          materialBox.innerHTML = "";
          photoList.textContent = "No files selected yet.";
          copyStatus.textContent = "";
          projectSections.forEach((section) => (section.style.display = "none"));
        }, 0);
      });
    })();
  </script>
</body>
</html>
